import streamlit as st

# --- è¨ˆç®—é‚è¼¯ (èˆ‡ä½ åŸæœ¬çš„ä¸€æ¨£) ---
def calculate_bmi(w, h_m):
    return round(w / (h_m ** 2), 2) if h_m > 0 else 0

def calculate_bmr(w, h_cm, age, gender):
    if gender == 'ç”·':
        return round((10 * w) + (6.25 * h_cm) - (5 * age) + 5, 0)
    return round((10 * w) + (6.25 * h_cm) - (5 * age) - 161, 0)

# --- ç¶²é ä»‹é¢è¨­è¨ˆ ---
st.set_page_config(page_title="BMI & TDEE æ¨¡æ“¬å™¨", page_icon="âš–ï¸")
st.title("âš–ï¸ BMI & é«”é‡è®ŠåŒ–æ¨¡æ“¬å™¨")

with st.sidebar:
    st.header("å€‹äººåƒæ•¸è¼¸å…¥")
    gender = st.radio("æ€§åˆ¥", ["ç”·", "å¥³"])
    age = st.number_input("å¹´é½¡", min_value=1, max_value=120, value=25)
    height = st.number_input("èº«é«˜ (cm)", min_value=50.0, value=170.0)
    weight = st.number_input("é«”é‡ (kg)", min_value=10.0, value=65.0)
    activity = st.select_slider("æ´»å‹•ç¨‹åº¦", options=["ä¹…å", "è¼•é‡", "ä¸­åº¦", "é«˜åº¦", "æ¥µé‡åº¦"])
    calories = st.number_input("é è¨ˆæ¯æ—¥æ”å–ç†±é‡ (kcal)", min_value=0, value=2000)
factors = {"ä¹…å": 1.2, "è¼•é‡": 1.375, "ä¸­åº¦": 1.55, "é«˜åº¦": 1.725, "æ¥µé‡åº¦": 1.9}
factor = factors[activity]
bmr = calculate_bmr(weight, height, age, gender)
tdee = bmr * factor
diff = calories - tdee
weight_change = (diff * 30) / 7700
col1, col2, col3 = st.columns(3)
col1.metric("åˆå§‹ BMI", calculate_bmi(weight, height/100))
col2.metric("BMR (åŸºç¤ä»£è¬)", f"{bmr:.0f}")
col3.metric("TDEE (ç¸½æ¶ˆè€—)", f"{tdee:.0f}")

st.divider()

if diff < 0:
    st.success(f"ğŸ”¥ è™•æ–¼ç†±é‡èµ¤å­—ï¼æ¯æ—¥å·®é¡ï¼š{diff:.0f} kcal")
else:
    st.warning(f"âš ï¸ è™•æ–¼ç†±é‡ç›ˆé¤˜ï¼æ¯æ—¥å·®é¡ï¼š+{diff:.0f} kcal")

st.subheader("ğŸ“… 30 å¤©å¾Œé æ¸¬")
st.write(f"é è¨ˆé«”é‡è®ŠåŒ–ï¼š**{weight_change:+.2f} kg**")
st.write(f"é è¨ˆæœ€çµ‚é«”é‡ï¼š**{weight + weight_change:.2f} kg**")
